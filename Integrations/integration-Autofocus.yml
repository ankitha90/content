commonfields:
  id: Autofocus
  version: -1
name: Autofocus
display: Palo Alto Networks Autofocus
category: Data Enrichment & Threat Intelligence
image: data:image/png;base64,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
description: Palo Alto Networks AutoFocus enables you to distinguish the most important
  threats from everyday commodity attacks.
detaileddescription: |-
  Step 1: Login and add your authorization code
  1. Visit [PAN support](https://support.paloaltonetworks.com).
  2. Select the Assets > Site Licenses tab.
  3. Select Add Site License.
  4. Enter the authorization code.
  Step 2: Activate the API.
  1. Select the Enable action in Site Licenses.
  2. Select the API Key link.

  The API key appears onscreen as shown below. Use this API
  key for all AutoFocus API requests
configuration:
- display: Server URL
  name: server
  defaultvalue: https://autofocus.paloaltonetworks.com/
  type: 0
  required: true
- display: Version
  name: version
  defaultvalue: v1.0
  type: 0
  required: true
- display: API Key
  name: apiKey
  defaultvalue: ""
  type: 4
  required: true
- display: Use system proxy settings
  name: useproxy
  defaultvalue: "true"
  type: 8
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: "false"
  type: 8
  required: false
script:
  script: |
    var SERVER = params.server.replace(/[\/]+$/, '') + '/api/' + params.version + '/';

    function doReq(path, data) {
        data.apiKey = params.apiKey;
        var result = http(
            SERVER + path,
            {
                Headers: {'Content-Type': ['application/json'], 'Accept': ['application/json']},
                Method: 'POST',
                Body: JSON.stringify(data)
            },
            params.insecure,
            params.useproxy
        );

        if (result.StatusCode < 200 || result.StatusCode > 299) {
            if (result.StatusCode == 503) {
                throw '503 - Rate limit exceeded. Contact your Autofocus representative.';
            }
            if (result.StatusCode == 409) {
                throw '409 - Invalid message or missing parameters.';
            }
            else {
                throw 'Failed to perform request ' + path + ', request status code: ' + result.StatusCode + '\n' + result.Body;
            }
        }
        if (result.Body === '') {
            throw 'No content received.';
        }
        var obj;
        try {
            obj = JSON.parse(result.Body);
        } catch (ex) {
            throw 'Error parsing reply - ' + result.Body + ' - ' + ex;
        }
        return {
            body: result.Body,
            obj: obj,
            statusCode: result.StatusCode
        };
    }


    function doSearch(prefix) {
        var cookie = args.cookie;
        if (!cookie) {
            var q = {};
            q.query = JSON.parse(args.query);
            q.from = parseInt(args.from);
            q.size = parseInt(args.size);
            if (args.sort) {
                q.sort = {};
                q.sort[args.sort] = {order: (args.order ? args.order : 'asc')};
            }
            if (args.scope) {
                q.scope = args.scope;
            }
            var res = doReq(prefix + '/search/', q);
            if (!res.obj.af_cookie) {
                throw 'Unable to retrieve cookie of search results';
            }
            cookie = res.obj.af_cookie;
        }
        var checks = (args.checks) ? parseInt(args.checks) : 10;
        var sleep = (args.sleep) ? parseInt(args.sleep) : 3;
        var res1;
        var ec = {'Autofocus.Cookie': cookie};
        while (checks > 0) {
            checks--;
            wait(sleep);
            res1 = doReq(prefix + '/results/' + cookie, {});
            if (res1.obj && res1.obj.af_message && res1.obj.af_in_progress && res1.obj.hits) {
                if (res1.obj.af_message === 'complete' || res1.obj.af_in_progress === false || res1.obj.hits.length >= parseInt(args.size)) {
                    var md = '## PAN Autofocus ' + prefix + ' result\n';
                    md += 'Total: ' + res1.obj.total + '\nTook: ' + res1.obj.took + '\n';
                    var hits = [];
                    for (var i=0; i<res1.obj.hits.length; i++) {
                        var data = res1.obj.hits[i]._source;
                        data.id = res1.obj.hits[i]._id;
                        hits.push(data);
                    }
                    ec['Autofocus.S' + prefix.substr(1)] = hits;
                    md += tableToMarkdown('S' + prefix.substr(1), hits);
                    return {
                        Type: entryTypes.note,
                        Contents: res1.body,
                        ContentsFormat: formats.json,
                        HumanReadable: md,
                        EntryContext: ec
                    };
                }
            }
        }
        return {
            Type: entryTypes.note,
            Contents: ec,
            ContentsFormat: formats.json,
            HumanReadable: 'PAN Autofocus timeout occured waiting for results, cookie is: ' + cookie,
            EntryContext: ec
        };
    }


    function doSession(id) {
        var res = doReq('session/' + id, {});
        if (res1.obj && res1.obj.af_message && res1.obj.af_in_progress && res1.obj.hits) {
            if (res.obj.af_message === 'complete' || res.obj.af_in_progress === false || res.obj.hits.length >= 1) {
                var hits = [];
                for (var i=0; i<res.obj.hits.length; i++) {
                    var data = res.obj.hits[i]._source;
                    data.id = res.obj.hits[i]._id;
                    hits.push(data);
                }
                md = tableToMarkdown('PAN Autofocus session details', hits);
                md += 'Took: ' + res.obj.took + '\n';
                return {
                    Type: entryTypes.note,
                    Contents: res.body,
                    ContentsFormat: formats.json,
                    HumanReadable: md,
                    EntryContext: {'Autofocus.Sessions': hits}
                };
            }
        }
        return {
            Type: entryTypes.note,
            ContentsFormat: formats.markdown,
            Contents: 'PAN Autofocus no session for: ' + id
        };
    }


    function doSample() {
        var p = {};
        if (args.sections) {
            p.sections = argToList(args.sections);
        }
        if (args.platforms) {
            p.platforms = argToList(args.platforms);
        }
        if (args.coverage === 'true') {
            p.coverage = true;
            if (p.sections && p.sections.indexOf('coverage') < 0) {
                p.sections.push('coverage');
            }
        }
        var res = doReq('sample/' + args.id + '/analysis', p);
        md = '## PAN Autofocus Sample Analysis\n';
        md += '### Sections: ' + res.obj.sections.join(', ') + '\n';
        md += '### Platforms: ' +  res.obj.platforms.join(', ') + '\n';
        if (res.obj.coverage) {
            Object.keys(res.obj.coverage).forEach(function(s) {
                if (Object.keys(res.obj.coverage[s]).length) {
                    md += tableToMarkdown('Coverage ' + s, res.obj.coverage[s]) + '\n';
                }
            });
        }
        res.obj.sections.forEach(function(s) {
            if (s === 'coverage') {
                return;
            }
            res.obj.platforms.forEach(function(p) {
                if (res.obj[s][p]) {
                    md += tableToMarkdown(s + ' - ' + p, res.obj[s][p]) + '\n';
                }
            });
        });
        return {
            Type: entryTypes.note,
            Contents: res.body,
            ContentsFormat: formats.json,
            HumanReadable: md
        };
    }

    switch (command) {

        case 'test-module':
            doReq('samples/search/', {query: {operator: 'all', children: [{field: 'sample.malware', operator: 'is', value: 1}]}, size: 1, from: 0, scope: 'public'});
            return 'ok';

        case 'autofocus-search-samples':
            return doSearch('samples');

        case 'autofocus-search-sessions':
            return doSearch('sessions');

        case 'autofocus-session':
            return doSession(args.id);

        case 'autofocus-sample-analysis':
            return doSample(args.id);

        case 'file':
            args.size = 1;
            args.from = 0;
            args.scope = 'public';
            var hash = args.file.length === 64 ? 'sha256' : args.file.length === 40 ? 'sha1' : 'md5';
            args.query = JSON.stringify({operator: 'all', children: [{field: 'sample.' + hash, operator: 'is', value: args.file}]});
            var search = doSearch('samples');
            if (search.EntryContext && search.EntryContext['Autofocus.Samples'] && search.EntryContext['Autofocus.Samples'].length > 0) {
                var c = search.EntryContext['Autofocus.Samples'][0];
                var dbotScore = [];
                ['md5', 'sha1', 'sha256'].forEach(function(h) {
                    if (c[h]) {
                        dbotScore.push({Indicator: c[h], Type: 'hash', Vendor: 'PAN Autofocus', Score: c.malware === 1 ? 3 : 1,
                            Description: c.tag && c.tag.length > 0 ? c.tag.join(', ') : c.malware === 1 ? 'Marked as malware' : ''});
                    }
                });
                var ec = {DBotScore: dbotScore};
                var f = {MD5: c.md5, SHA1: c.sha1, SHA256: c.sha256, Size: c.size, SSDeep: c.ssdeep, Region: c.region ? c.region.join(',') : '', Info: c.filetype, Type: c.filetype};
                if (c.malware === 1) {
                    f.properties_to_append = ['Malicious'];
                    f.Malicious = {Vendor: 'PAN Autofocus', Description: dbotScore[0].Description};
                }
                ec[outputPaths.file] = f;
                // Now, let's add any interesting sessions we've encountered to the display
                args.size = 50;
                delete args.scope;
                args.query = JSON.stringify({operator: 'all', children: [{field: 'session.sha256', operator: 'is', value: c.sha256}]});
                var md = search.HumanReadable;
                var sessions = doSearch('sessions');
                if (sessions.EntryContext && sessions.EntryContext['Autofocus.Sessions'] && sessions.EntryContext['Autofocus.Sessions'].length > 0) {
                    md += '\n' + sessions.HumanReadable;
                }
                return {
                    Type: entryTypes.note,
                    Contents: search.Contents,
                    ContentsFormat: formats.json,
                    HumanReadable: md,
                    EntryContext: ec
                };
            }
            return {
                Type: entryTypes.note,
                ContentsFormat: formats.markdown,
                Contents: 'PAN Autofocus no data for: ' + args.file
            };

        default:
            throw 'Unknown command "' + command + '"';
    }
  type: javascript
  commands:
  - name: autofocus-search-samples
    arguments:
    - name: scope
      auto: PREDEFINED
      predefined:
      - private
      - public
      - global
      description: The scope for the search
      defaultValue: public
    - name: size
      description: Number of results
      defaultValue: "50"
    - name: from
      description: Sample number to start from
      defaultValue: "0"
    - name: sort
      auto: PREDEFINED
      predefined:
      - app_name
      - app_packagename
      - filetype
      - size
      - finish_date
      - create_date
      - update_date
      - md5
      - sha1
      - sha256
      - ssdeep
      description: Sort field
    - name: order
      auto: PREDEFINED
      predefined:
      - asc
      - desc
      description: Order of sort
    - name: query
      required: true
      description: The query to retrieve samples
    - name: sleep
      description: Time to sleep between checking for results
      defaultValue: "3"
    - name: checks
      description: Number of checks before giving up on the query
      defaultValue: "10"
    - name: cookie
      description: The af_cookie for retrieving previous search results
    outputs:
    - contextPath: Autofocus.Cookie
      description: The cookie for the results
      type: string
    - contextPath: Autofocus.Samples.id
      description: ID of sample
      type: string
    - contextPath: Autofocus.Samples.md5
      description: MD5 of the sample
      type: string
    - contextPath: Autofocus.Samples.sha1
      description: SHA1 of the sample
      type: string
    - contextPath: Autofocus.Samples.sha256
      description: SHA256 of the sample
      type: string
    - contextPath: Autofocus.Samples.app_name
      description: Application name (if exists)
      type: string
    - contextPath: Autofocus.Samples.size
      description: The size of the sample
      type: number
    - contextPath: Autofocus.Samples.ssdeep
      description: SSDeep of the sample
      type: string
    - contextPath: Autofocus.Samples.create_date
      description: The create date for the sample
      type: string
    - contextPath: Autofocus.Samples.finish_date
      description: The finish date for the sample
      type: string
    - contextPath: Autofocus.Samples.malware
      description: A flag (0/1) if this is malware
      type: string
    - contextPath: Autofocus.Samples.app_packagename
      description: The sample package name (if exists)
      type: string
    - contextPath: Autofocus.Samples.filetype
      description: The sample type
      type: string
    - contextPath: Autofocus.Samples.region
      description: Where have we seen this sample
      type: number
    - contextPath: Autofocus.Samples.tag
      description: Sample tags
      type: string
    description: Search for samples on Autofocus
  - name: autofocus-search-sessions
    arguments:
    - name: size
      description: Number of results
      defaultValue: "50"
    - name: from
      description: Sample number to start from
      defaultValue: "0"
    - name: sort
      auto: PREDEFINED
      predefined:
      - app
      - device_country
      - device_countrycode
      - device_hostname
      - device_serial
      - vsys
      - dst_country
      - dst_countrycode
      - dst_ip
      - dst_port
      - emailsbjcharset
      - device_industry
      - src_country
      - src_countrycode
      - src_ip
      - src_port
      - sha256
      - tstamp
      - upload_src
      description: Sort field
    - name: order
      auto: PREDEFINED
      predefined:
      - asc
      - desc
      description: Order of sort
    - name: query
      required: true
      description: The query to retrieve samples
    - name: sleep
      description: Time to sleep between checking for results
      defaultValue: "3"
    - name: checks
      description: Number of checks before giving up on the query
      defaultValue: "10"
    - name: cookie
      description: The af_cookie for retrieving previous search results
    outputs:
    - contextPath: Autofocus.Cookie
      description: The cookie for the results
      type: string
    - contextPath: Autofocus.Sessions.id
      description: ID of the session
      type: string
    - contextPath: Autofocus.Sessions.device_industry
      description: Device industry
      type: string
    - contextPath: Autofocus.Sessions.filename
      description: The name of the file
      type: string
    - contextPath: Autofocus.Sessions.region
      description: Region for the session
      type: string
    - contextPath: Autofocus.Sessions.sha256
      description: SHA256 of the file
      type: string
    - contextPath: Autofocus.Sessions.tstamp
      description: Timestamp for session
      type: string
    - contextPath: Autofocus.Sessions.upload_src
      description: Where did we get the file
      type: string
    description: Search for sessions on Autofocus
  - name: autofocus-session
    arguments:
    - name: id
      required: true
      default: true
      description: The session ID to retrieve details for
    outputs:
    - contextPath: Autofocus.Sessions.id
      description: ID of the session
      type: string
    - contextPath: Autofocus.Sessions.device_industry
      description: Device industry
      type: string
    - contextPath: Autofocus.Sessions.filename
      description: The name of the file
      type: string
    - contextPath: Autofocus.Sessions.region
      description: Region for the session
      type: string
    - contextPath: Autofocus.Sessions.sha256
      description: SHA256 of the file
      type: string
    - contextPath: Autofocus.Sessions.tstamp
      description: Timestamp for session
      type: string
    - contextPath: Autofocus.Sessions.upload_src
      description: Where did we get the file
      type: string
    description: Get details of a specific session
  - name: autofocus-sample-analysis
    arguments:
    - name: id
      required: true
      default: true
      description: The sample id
    - name: coverage
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Should we display coverage
      defaultValue: "true"
    - name: sections
      description: 'comma-separated list of sections to display: apk_app_icon, apk_app_name,
        apk_cert_file, apk_certificate_id, apk_defined_activity, apk_defined_intent_filter,
        apk_defined_receiver, apk_defined_sensor, apk_defined_service, apk_digital_signer,
        apk_embedded_library, apk_embeded_url, apk_internal_file, apk_isrepackaged,
        apk_packagename, apk_requested_permission, apk_sensitive_api_call, apk_suspicious_behavior,
        apk_suspicious_file, apk_suspicious_pattern, apk_suspicious_action_monitored,
        apk_suspicious_file, apk_suspicious_string, apk_version_num, behavior_type,
        connection, coverage, dns, file, http, japi, mac_embedded_url, misc, mutex,
        process, registry, service, user_agent'
      defaultValue: file
    - name: platforms
      description: 'comma-separated list of platforms: win7, winxp, android, staticAnalyzer,
        mac'
    description: Retrieve the sample analysis
  - name: file
    arguments:
    - name: file
      required: true
      default: true
      description: Hash of the file to query. Supports MD5, SHA1 and SHA256.
    outputs:
    - contextPath: File.MD5
      description: File MD5 hash
      type: string
    - contextPath: File.SHA1
      description: File SHA1 hash
      type: string
    - contextPath: File.SHA256
      description: File SHA256 hash
      type: string
    - contextPath: File.Malicious.Vendor
      description: For malicious files, the vendor that made the decision
      type: string
    - contextPath: File.Malicious.Description
      description: For malicious files, the reason for the vendor to make the decision
      type: string
    - contextPath: DBotScore.Indicator
      description: The indicator we tested
      type: string
    - contextPath: DBotScore.Type
      description: The type of the indicator
      type: string
    - contextPath: DBotScore.Vendor
      description: Vendor used to calculate the Score
      type: string
    - contextPath: DBotScore.Score
      description: The actual score
      type: number
    - contextPath: DBotScore.Description
      description: The reason for the score (if any)
      type: string
    description: Check file reputation of the given hash
  runonce: false
tests:
- autofocus_test
releaseNotes: Change integration name and logo, handle missing values in responses.